<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=../frontend/01-overview.html><link rel=next href=../database/01-overview.html><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Overview - EPFL Project Technical Docs</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#backend-overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title="EPFL Project Technical Docs" class="md-header__button md-logo" aria-label="EPFL Project Technical Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EPFL Project Technical Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Overview </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=cyan aria-hidden=true type=radio name=__palette id=__palette_0> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=cyan aria-hidden=true type=radio name=__palette id=__palette_1> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/epfl-enac/co2-calculator title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../index.html class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../architecture/index.html class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../architecture-decision-records/index.html class=md-tabs__link> Architecture Decision Records </a> </li> <li class=md-tabs__item> <a href=../frontend/01-overview.html class=md-tabs__link> Frontend </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=01-overview.html class=md-tabs__link> Backend </a> </li> <li class=md-tabs__item> <a href=../database/01-overview.html class=md-tabs__link> Database </a> </li> <li class=md-tabs__item> <a href=../infra/01-overview.html class=md-tabs__link> Infrastructure </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title="EPFL Project Technical Docs" class="md-nav__button md-logo" aria-label="EPFL Project Technical Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> EPFL Project Technical Docs </label> <div class=md-nav__source> <a href=https://github.com/epfl-enac/co2-calculator title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../architecture/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../architecture/01-purpose-scope.html class=md-nav__link> <span class=md-ellipsis> Purpose & Scope </span> </a> </li> <li class=md-nav__item> <a href=../architecture/02-system-overview.html class=md-nav__link> <span class=md-ellipsis> System Overview </span> </a> </li> <li class=md-nav__item> <a href=../architecture/03-subsystem-map.html class=md-nav__link> <span class=md-ellipsis> Subsystem Map </span> </a> </li> <li class=md-nav__item> <a href=../architecture/04-auth-flow.html class=md-nav__link> <span class=md-ellipsis> Auth Flow </span> </a> </li> <li class=md-nav__item> <a href=../architecture/05-environments.html class=md-nav__link> <span class=md-ellipsis> Environments </span> </a> </li> <li class=md-nav__item> <a href=../architecture/06-cicd-pipeline.html class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../architecture/07-global-conventions.html class=md-nav__link> <span class=md-ellipsis> Global Conventions </span> </a> </li> <li class=md-nav__item> <a href=../architecture/08-tech-stack.html class=md-nav__link> <span class=md-ellipsis> Tech Stack </span> </a> </li> <li class=md-nav__item> <a href=../architecture/09-component-breakdown.html class=md-nav__link> <span class=md-ellipsis> Component Breakdown </span> </a> </li> <li class=md-nav__item> <a href=../architecture/10-data-flow.html class=md-nav__link> <span class=md-ellipsis> Data Flow </span> </a> </li> <li class=md-nav__item> <a href=../architecture/11-deployment-topology.html class=md-nav__link> <span class=md-ellipsis> Deployment Topology </span> </a> </li> <li class=md-nav__item> <a href=../architecture/12-scalability.html class=md-nav__link> <span class=md-ellipsis> Scalability </span> </a> </li> <li class=md-nav__item> <a href=../architecture/13-cross-cutting-concerns.html class=md-nav__link> <span class=md-ellipsis> Cross-Cutting Concerns </span> </a> </li> <li class=md-nav__item> <a href=../architecture/14-architectural-decisions.html class=md-nav__link> <span class=md-ellipsis> Architectural Decisions </span> </a> </li> <li class=md-nav__item> <a href=../architecture/15-appendices.html class=md-nav__link> <span class=md-ellipsis> Appendices </span> </a> </li> <li class=md-nav__item> <a href=../architecture/epfl-compliance-mapping.html class=md-nav__link> <span class=md-ellipsis> EPFL Compliance </span> </a> </li> <li class=md-nav__item> <a href=../architecture/code-standards.html class=md-nav__link> <span class=md-ellipsis> Code Standards </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Architecture Decision Records </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture Decision Records </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../architecture-decision-records/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/001-python-package-manager.html class=md-nav__link> <span class=md-ellipsis> ADR-001 Python Package Manager </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/002-frontend-framework.html class=md-nav__link> <span class=md-ellipsis> ADR-002 Frontend Framework </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/003-backend-framework.html class=md-nav__link> <span class=md-ellipsis> ADR-003 Backend Framework </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/004-database-selection.html class=md-nav__link> <span class=md-ellipsis> ADR-004 Database Selection </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/005-authorization-strategy.html class=md-nav__link> <span class=md-ellipsis> ADR-005 Authorization Strategy </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/010-background-job-processing.html class=md-nav__link> <span class=md-ellipsis> ADR-010 Background Job Processing </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/012-jwt-authentication-strategy.html class=md-nav__link> <span class=md-ellipsis> ADR-012 JWT Authentication </span> </a> </li> <li class=md-nav__item> <a href=../architecture-decision-records/013-object-storage-strategy.html class=md-nav__link> <span class=md-ellipsis> ADR-013 Object Storage </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Frontend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../frontend/01-overview.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Backend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Backend </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Overview </span> <span class="md-nav__icon md-icon"></span> </label> <a href=01-overview.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Overview </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> <nav class=md-nav aria-label="Quick Start"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-development-without-docker class=md-nav__link> <span class=md-ellipsis> Local Development Without Docker </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#architecture-overview class=md-nav__link> <span class=md-ellipsis> Architecture Overview </span> </a> </li> <li class=md-nav__item> <a href=#key-api-endpoints class=md-nav__link> <span class=md-ellipsis> Key API Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#development-workflow class=md-nav__link> <span class=md-ellipsis> Development Workflow </span> </a> <nav class=md-nav aria-label="Development Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#running-tests class=md-nav__link> <span class=md-ellipsis> Running Tests </span> </a> </li> <li class=md-nav__item> <a href=#code-quality class=md-nav__link> <span class=md-ellipsis> Code Quality </span> </a> </li> <li class=md-nav__item> <a href=#database-migrations class=md-nav__link> <span class=md-ellipsis> Database Migrations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=#background-processing class=md-nav__link> <span class=md-ellipsis> Background Processing </span> </a> </li> <li class=md-nav__item> <a href=#authentication-authorization class=md-nav__link> <span class=md-ellipsis> Authentication &amp; Authorization </span> </a> <nav class=md-nav aria-label="Authentication & Authorization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#authentication-flow-oidc-jwt class=md-nav__link> <span class=md-ellipsis> Authentication Flow (OIDC + JWT) </span> </a> </li> <li class=md-nav__item> <a href=#authorization-rbac class=md-nav__link> <span class=md-ellipsis> Authorization (RBAC) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-features class=md-nav__link> <span class=md-ellipsis> Security Features </span> </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#database-connection-issues class=md-nav__link> <span class=md-ellipsis> Database Connection Issues </span> </a> </li> <li class=md-nav__item> <a href=#background-task-failures class=md-nav__link> <span class=md-ellipsis> Background Task Failures </span> </a> </li> <li class=md-nav__item> <a href=#enable-debug-logging class=md-nav__link> <span class=md-ellipsis> Enable Debug Logging </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#production-deployment class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> <li class=md-nav__item> <a href=#performance-optimization class=md-nav__link> <span class=md-ellipsis> Performance Optimization </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> <nav class=md-nav aria-label="Next Steps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-new-developers class=md-nav__link> <span class=md-ellipsis> For New Developers </span> </a> </li> <li class=md-nav__item> <a href=#for-api-consumers class=md-nav__link> <span class=md-ellipsis> For API Consumers </span> </a> </li> <li class=md-nav__item> <a href=#external-documentation class=md-nav__link> <span class=md-ellipsis> External Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Database </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../database/01-overview.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../infra/01-overview.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=backend-overview>Backend Overview<a class=headerlink href=#backend-overview title="Permanent link">&para;</a></h1> <p>This guide covers the FastAPI backend for CO2 emissions tracking. Use it to set up your local environment, understand the API structure, and deploy to production. The backend uses PostgreSQL for data persistence, OIDC for authentication, and Celery for asynchronous tasks.</p> <p>Read this if you need to set up the backend locally, understand how the API works, or deploy to production.</p> <p>For deeper architectural details, see:</p> <ul> <li><a href=02-ARCHITECTURE.html>Architecture</a> - Layer patterns</li> <li><a href=03-FILE_STRUCTURE.html>File Structure</a> - Code organization</li> <li><a href=05-REQUEST_FLOW.html>Request Flow</a> - Request lifecycle</li> </ul> <h2 id=quick-start>Quick Start<a class=headerlink href=#quick-start title="Permanent link">&para;</a></h2> <p>Start all services with Docker Compose:</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>backend
make<span class=w> </span>docker-up
</code></pre></div> <p>The API runs at http://localhost:8000. View interactive docs at http://localhost:8000/docs.</p> <p>Stop services with:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>docker-down
</code></pre></div> <h3 id=local-development-without-docker>Local Development Without Docker<a class=headerlink href=#local-development-without-docker title="Permanent link">&para;</a></h3> <p>Install dependencies and configure your environment:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>install
cp<span class=w> </span>.env.example<span class=w> </span>.env
<span class=c1># Edit .env: set DATABASE_URL, SECRET_KEY, OIDC_* variables</span>
</code></pre></div> <p>Run migrations and start the server:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>db-migrate
make<span class=w> </span>run
</code></pre></div> <p>Requires Python 3.11+ and PostgreSQL 15+.</p> <h2 id=architecture-overview>Architecture Overview<a class=headerlink href=#architecture-overview title="Permanent link">&para;</a></h2> <p>The backend uses a layered architecture with clear separation of concerns. Each layer handles one responsibility:</p> <table> <thead> <tr> <th>Layer</th> <th>Location</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><strong>API</strong></td> <td><code>app/api/</code></td> <td>HTTP routing, request handling</td> </tr> <tr> <td><strong>Service</strong></td> <td><code>app/services/</code></td> <td>Business logic, authorization</td> </tr> <tr> <td><strong>Repository</strong></td> <td><code>app/repositories/</code></td> <td>Database queries</td> </tr> <tr> <td><strong>Models</strong></td> <td><code>app/models/</code></td> <td>SQLAlchemy ORM schemas</td> </tr> <tr> <td><strong>Schemas</strong></td> <td><code>app/schemas/</code></td> <td>Pydantic validation</td> </tr> </tbody> </table> <p>Authorization happens in the service layer. Repositories are policy-agnostic and receive filters from services.</p> <p>See <a href=02-ARCHITECTURE.html>Architecture</a> for complete layer details.</p> <h2 id=key-api-endpoints>Key API Endpoints<a class=headerlink href=#key-api-endpoints title="Permanent link">&para;</a></h2> <p>Visit http://localhost:8000/docs for the complete OpenAPI specification. Main endpoint groups:</p> <p><strong>Authentication</strong></p> <ul> <li><code>POST /api/v1/auth/login</code> - Initiate OIDC login</li> <li><code>GET /api/v1/users/me</code> - Current user profile</li> </ul> <p><strong>Laboratory Management</strong></p> <ul> <li><code>GET /api/v1/labs</code> - List labs</li> <li><code>POST /api/v1/labs</code> - Create lab</li> <li><code>PUT /api/v1/labs/{id}</code> - Update lab</li> <li><code>DELETE /api/v1/labs/{id}</code> - Delete lab</li> </ul> <p><strong>Data Import</strong></p> <ul> <li><code>POST /api/v1/labs/{id}/imports</code> - Upload CSV</li> <li><code>GET /api/v1/imports/{id}/status</code> - Check status</li> </ul> <p><strong>Reporting</strong></p> <ul> <li><code>GET /api/v1/reports/{lab_id}</code> - Generate report</li> </ul> <h2 id=development-workflow>Development Workflow<a class=headerlink href=#development-workflow title="Permanent link">&para;</a></h2> <h3 id=running-tests>Running Tests<a class=headerlink href=#running-tests title="Permanent link">&para;</a></h3> <p>Run all tests with coverage:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span><span class=nb>test</span>
pytest<span class=w> </span>tests/test_resources.py<span class=w> </span>-v<span class=w>  </span><span class=c1># Specific file</span>
</code></pre></div> <p>Coverage reports appear in <code>htmlcov/index.html</code>.</p> <h3 id=code-quality>Code Quality<a class=headerlink href=#code-quality title="Permanent link">&para;</a></h3> <p>Format and lint your code:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>format<span class=w>     </span><span class=c1># Format with black + isort</span>
make<span class=w> </span>lint<span class=w>       </span><span class=c1># Check with ruff + mypy</span>
</code></pre></div> <h3 id=database-migrations>Database Migrations<a class=headerlink href=#database-migrations title="Permanent link">&para;</a></h3> <p>Manage schema changes with Alembic:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>db-revision<span class=w> </span><span class=nv>message</span><span class=o>=</span><span class=s2>&quot;Add user preferences&quot;</span>
make<span class=w> </span>db-migrate<span class=w>     </span><span class=c1># Apply migrations</span>
make<span class=w> </span>db-downgrade<span class=w>   </span><span class=c1># Rollback one step</span>
</code></pre></div> <h2 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">&para;</a></h2> <p>Copy <code>.env.example</code> to <code>.env</code> and set these variables:</p> <div class=highlight><pre><span></span><code># Database
DATABASE_URL=postgresql://user:pass@localhost:5432/co2calculator

# Security (generate: openssl rand -hex 32)
SECRET_KEY=your-secret-key-here
ACCESS_TOKEN_EXPIRE_MINUTES=30

# OIDC Authentication
OIDC_DISCOVERY_URL=https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration
OIDC_CLIENT_ID=your-client-id
OIDC_CLIENT_SECRET=your-client-secret

# Background Tasks
REDIS_URL=redis://localhost:6379/0

# CORS
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
</code></pre></div> <p>For production: set <code>DEBUG=false</code>, use strong <code>SECRET_KEY</code>, and restrict <code>CORS_ORIGINS</code> to your frontend domain.</p> <h2 id=background-processing>Background Processing<a class=headerlink href=#background-processing title="Permanent link">&para;</a></h2> <p>Celery handles long-running tasks with Redis as message broker:</p> <div class=highlight><pre><span></span><code>make<span class=w> </span>celery-worker<span class=w>  </span><span class=c1># Start worker</span>
make<span class=w> </span>celery-beat<span class=w>    </span><span class=c1># Start scheduler</span>
make<span class=w> </span>celery-flower<span class=w>  </span><span class=c1># Web monitoring UI</span>
</code></pre></div> <p>Tasks include CSV import processing, emission calculations, report generation, and email notifications.</p> <h2 id=authentication-authorization>Authentication &amp; Authorization<a class=headerlink href=#authentication-authorization title="Permanent link">&para;</a></h2> <h3 id=authentication-flow-oidc-jwt>Authentication Flow (OIDC + JWT)<a class=headerlink href=#authentication-flow-oidc-jwt title="Permanent link">&para;</a></h3> <ol> <li>Frontend redirects user to Microsoft Entra ID</li> <li>User authenticates with EPFL credentials</li> <li>Backend validates OIDC token and extracts claims</li> <li>Backend issues JWT for subsequent requests</li> <li>Frontend includes JWT in <code>Authorization: Bearer &lt;token&gt;</code></li> </ol> <h3 id=authorization-rbac>Authorization (RBAC)<a class=headerlink href=#authorization-rbac title="Permanent link">&para;</a></h3> <ul> <li><strong>Roles</strong>: <code>admin</code>, <code>lab_manager</code>, <code>lab_member</code>, <code>viewer</code></li> <li><strong>Permissions</strong>: Checked in service layer before data access</li> <li><strong>Resource ownership</strong>: Users access only their labs (unless admin)</li> </ul> <p>Authorization uses in-code RBAC for simplicity rather than Open Policy Agent.</p> <h2 id=security-features>Security Features<a class=headerlink href=#security-features title="Permanent link">&para;</a></h2> <ul> <li><strong>Input Validation</strong>: Pydantic schemas on all endpoints</li> <li><strong>SQL Injection Prevention</strong>: SQLAlchemy ORM with parameterized queries</li> <li><strong>XSS Prevention</strong>: JSON-only responses</li> <li><strong>Rate Limiting</strong>: Configurable per endpoint</li> <li><strong>Authentication Required</strong>: All endpoints except <code>/health</code> and <code>/docs</code></li> </ul> <p>CSRF protection is not needed (stateless JWT, no cookies).</p> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=database-connection-issues>Database Connection Issues<a class=headerlink href=#database-connection-issues title="Permanent link">&para;</a></h3> <p>Check if PostgreSQL is running:</p> <div class=highlight><pre><span></span><code>docker-compose<span class=w> </span>ps<span class=w> </span>postgres
docker-compose<span class=w> </span>logs<span class=w> </span>postgres
psql<span class=w> </span><span class=nv>$DATABASE_URL</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;SELECT 1;&quot;</span>
</code></pre></div> <h3 id=background-task-failures>Background Task Failures<a class=headerlink href=#background-task-failures title="Permanent link">&para;</a></h3> <p>View worker logs:</p> <div class=highlight><pre><span></span><code>docker-compose<span class=w> </span>logs<span class=w> </span>celery-worker
redis-cli<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-p<span class=w> </span><span class=m>6379</span><span class=w> </span>LLEN<span class=w> </span>celery
</code></pre></div> <h3 id=enable-debug-logging>Enable Debug Logging<a class=headerlink href=#enable-debug-logging title="Permanent link">&para;</a></h3> <p>Set in <code>.env</code>:</p> <div class=highlight><pre><span></span><code>LOG_LEVEL=DEBUG
DEBUG=true
</code></pre></div> <p>View logs:</p> <div class=highlight><pre><span></span><code>docker-compose<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>backend
</code></pre></div> <h2 id=production-deployment>Production Deployment<a class=headerlink href=#production-deployment title="Permanent link">&para;</a></h2> <p>Critical checklist:</p> <ol> <li>Set <code>DEBUG=false</code></li> <li>Generate secure <code>SECRET_KEY</code>: <code>openssl rand -hex 32</code></li> <li>Rotate database credentials regularly</li> <li>Restrict <code>CORS_ORIGINS</code> to your frontend domain</li> <li>Use Gunicorn with Uvicorn workers:</li> </ol> <div class=highlight><pre><span></span><code>gunicorn<span class=w> </span>app.main:app<span class=w> </span>-w<span class=w> </span><span class=m>4</span><span class=w> </span>-k<span class=w> </span>uvicorn.workers.UvicornWorker
</code></pre></div> <h2 id=performance-optimization>Performance Optimization<a class=headerlink href=#performance-optimization title="Permanent link">&para;</a></h2> <p>Applied optimizations:</p> <ul> <li><strong>Connection Pooling</strong>: SQLAlchemy pool (size: 20, overflow: 10)</li> <li><strong>Query Optimization</strong>: Eager loading to avoid N+1 queries</li> <li><strong>Caching</strong>: Redis for frequently accessed data</li> <li><strong>Async Operations</strong>: FastAPI async endpoints for I/O tasks</li> <li><strong>Background Jobs</strong>: Celery offloads long operations</li> </ul> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <h3 id=for-new-developers>For New Developers<a class=headerlink href=#for-new-developers title="Permanent link">&para;</a></h3> <ol> <li>Complete Quick Start above</li> <li>Read <a href=02-ARCHITECTURE.html>Architecture</a> for layer patterns</li> <li>Study <a href=05-REQUEST_FLOW.html>Request Flow</a> for request lifecycle</li> <li>Explore <a href=03-FILE_STRUCTURE.html>File Structure</a> for navigation</li> </ol> <h3 id=for-api-consumers>For API Consumers<a class=headerlink href=#for-api-consumers title="Permanent link">&para;</a></h3> <ol> <li>Start server: <code>make docker-up</code></li> <li>Open http://localhost:8000/docs</li> <li>Test endpoints with Swagger UI</li> </ol> <h3 id=external-documentation>External Documentation<a class=headerlink href=#external-documentation title="Permanent link">&para;</a></h3> <ul> <li><a href=https://fastapi.tiangolo.com/ >FastAPI</a></li> <li><a href=https://docs.sqlalchemy.org/ >SQLAlchemy</a></li> <li><a href=https://docs.celeryq.dev/ >Celery</a></li> <li><a href=https://docs.pydantic.dev/ >Pydantic</a></li> </ul> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>FastAPI backend with layered architecture. Start with <code>make docker-up</code>, explore API at <code>/docs</code>. Authorization in service layer, database queries in repositories. Celery handles background tasks. See <a href=02-ARCHITECTURE.html>Architecture</a> for details.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="November 11, 2025 10:45:10 CET">November 11, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg> </span> <nav> <a href=mailto:pierre.guilbert@epfl.ch>Guilbert Pierre</a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> 2025 EPFL â€” GPL-3.0 License. Built with MkDocs </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.annotate", "navigation.instant", "navigation.instant.prefetch"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "1.0.0"}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>