<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Full tech stach - EPFL Project Technical Docs</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#3-full-rationale-detailed-choices class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title="EPFL Project Technical Docs" class="md-header__button md-logo" aria-label="EPFL Project Technical Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EPFL Project Technical Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Full tech stach </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=cyan aria-hidden=true type=radio name=__palette id=__palette_0> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=cyan aria-hidden=true type=radio name=__palette id=__palette_1> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/epfl-enac/epfl-calculator-co2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../index.html class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=index.html class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../frontend/index.html class=md-tabs__link> Frontend </a> </li> <li class=md-tabs__item> <a href=../backend/index.html class=md-tabs__link> Backend </a> </li> <li class=md-tabs__item> <a href=../database/index.html class=md-tabs__link> Database </a> </li> <li class=md-tabs__item> <a href=../infra/index.html class=md-tabs__link> Infrastructure </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title="EPFL Project Technical Docs" class="md-nav__button md-logo" aria-label="EPFL Project Technical Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> EPFL Project Technical Docs </label> <div class=md-nav__source> <a href=https://github.com/epfl-enac/epfl-calculator-co2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=01-purpose-scope.html class=md-nav__link> <span class=md-ellipsis> Purpose & Scope </span> </a> </li> <li class=md-nav__item> <a href=02-system-overview.html class=md-nav__link> <span class=md-ellipsis> System Overview </span> </a> </li> <li class=md-nav__item> <a href=03-subsystem-map.html class=md-nav__link> <span class=md-ellipsis> Subsystem Map </span> </a> </li> <li class=md-nav__item> <a href=04-auth-flow.html class=md-nav__link> <span class=md-ellipsis> Auth Flow </span> </a> </li> <li class=md-nav__item> <a href=05-environments.html class=md-nav__link> <span class=md-ellipsis> Environments </span> </a> </li> <li class=md-nav__item> <a href=06-cicd-pipeline.html class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline </span> </a> </li> <li class=md-nav__item> <a href=07-global-conventions.html class=md-nav__link> <span class=md-ellipsis> Global Conventions </span> </a> </li> <li class=md-nav__item> <a href=08-tech-stack.html class=md-nav__link> <span class=md-ellipsis> Tech Stack </span> </a> </li> <li class=md-nav__item> <a href=09-component-breakdown.html class=md-nav__link> <span class=md-ellipsis> Component Breakdown </span> </a> </li> <li class=md-nav__item> <a href=10-data-flow.html class=md-nav__link> <span class=md-ellipsis> Data Flow </span> </a> </li> <li class=md-nav__item> <a href=11-deployment-topology.html class=md-nav__link> <span class=md-ellipsis> Deployment Topology </span> </a> </li> <li class=md-nav__item> <a href=12-scalability.html class=md-nav__link> <span class=md-ellipsis> Scalability </span> </a> </li> <li class=md-nav__item> <a href=13-cross-cutting-concerns.html class=md-nav__link> <span class=md-ellipsis> Cross-Cutting Concerns </span> </a> </li> <li class=md-nav__item> <a href=14-architectural-decisions.html class=md-nav__link> <span class=md-ellipsis> Architectural Decisions </span> </a> </li> <li class=md-nav__item> <a href=15-appendices.html class=md-nav__link> <span class=md-ellipsis> Appendices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Frontend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../frontend/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../frontend/architecture.html class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../frontend/ui-system.html class=md-nav__link> <span class=md-ellipsis> UI System </span> </a> </li> <li class=md-nav__item> <a href=../frontend/api.html class=md-nav__link> <span class=md-ellipsis> Data & API Integration </span> </a> </li> <li class=md-nav__item> <a href=../frontend/dev-guide.html class=md-nav__link> <span class=md-ellipsis> Dev Guide </span> </a> </li> <li class=md-nav__item> <a href=../frontend/testing.html class=md-nav__link> <span class=md-ellipsis> Testing & QA </span> </a> </li> <li class=md-nav__item> <a href=../frontend/deploy.html class=md-nav__link> <span class=md-ellipsis> Build & Deploy </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Backend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Backend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../backend/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../backend/architecture.html class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../backend/api.html class=md-nav__link> <span class=md-ellipsis> API Design </span> </a> </li> <li class=md-nav__item> <a href=../backend/plugins.html class=md-nav__link> <span class=md-ellipsis> Plugins / Extensions </span> </a> </li> <li class=md-nav__item> <a href=../backend/testing.html class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../backend/deploy.html class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Database </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../database/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../database/schema.html class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=../database/data-flows.html class=md-nav__link> <span class=md-ellipsis> Data Flows </span> </a> </li> <li class=md-nav__item> <a href=../database/migrations.html class=md-nav__link> <span class=md-ellipsis> Migrations </span> </a> </li> <li class=md-nav__item> <a href=../database/maintenance.html class=md-nav__link> <span class=md-ellipsis> Backups & Maintenance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../infra/index.html class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../infra/hosting.html class=md-nav__link> <span class=md-ellipsis> Hosting & Network </span> </a> </li> <li class=md-nav__item> <a href=../infra/monitoring.html class=md-nav__link> <span class=md-ellipsis> Monitoring & Logging </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Full tech stach</h1> <hr> <h2 id=3-full-rationale-detailed-choices>3 — Full rationale &amp; detailed choices<a class=headerlink href=#3-full-rationale-detailed-choices title="Permanent link">&para;</a></h2> <h3 id=31-frontend-choices-why>3.1 Frontend choices (why)<a class=headerlink href=#31-frontend-choices-why title="Permanent link">&para;</a></h3> <ul> <li><strong>npm</strong>: EPFL/industry standard; broad ecosystem; works seamlessly with Vite/Quasar.</li> <li><strong>Vite</strong>: lightning-fast dev server, HMR, small build overhead — ideal for Vue 3 modern stack and faster iteration. Supports SSR or SPA if needed later.</li> <li><strong>Vue 3</strong>: requested; stable, reactive composition API, good developer ergonomics; excellent TypeScript support if needed.</li> <li><strong>Quasar</strong>: component library + layout scaffolding + built-in PWA, i18n-friendly and speeds UI development; fits EPFL need for quick, consistent UI with themable design.</li> <li><strong>Pinia</strong>: modern, lightweight state management for Vue 3; easier to reason about than Vuex; integrates with devtools.</li> <li><strong>eCharts</strong>: powerful, rich charts; good for complex visualizations required by CO2 dashboards. It handles large datasets and interactive charts.</li> <li><strong>vue-i18n</strong>: EPFL needs multiple languages; this is a standard, robust solution.</li> <li><strong>marked</strong>: lightweight markdown renderer; v9 is modern and secure when used with proper sanitization (explain sanitization below).</li> </ul> <p><strong>Security &amp; accessibility notes for frontend</strong></p> <ul> <li>Sanitize any Markdown output (use DOMPurify or similar) before rendering to avoid XSS.</li> <li>Implement CSP headers via backend / ingress to reduce client-side risk.</li> <li>Ensure accessibility (a11y) — Quasar helps but audits required.</li> </ul> <hr> <h3 id=32-backend-choices-why>3.2 Backend choices (why)<a class=headerlink href=#32-backend-choices-why title="Permanent link">&para;</a></h3> <ul> <li><strong>Python 3.13 runtime</strong>: latest supported stable release increases performance and typing improvements. You listed <code>python = "^3.10"</code> in dependencies; that shows compatibility with 3.10+, so selecting 3.13 as runtime keeps compatibility while giving performance/security improvements. If a strict constraint demands 3.10 only, we can downgrade.</li> <li><strong>FastAPI</strong>: excellent async performance, automatic OpenAPI generation (required), good typing and developer speed, plays well with Uvicorn + asyncpg. It also produces clear, machine-readable API docs (Swagger) the cahier requires.</li> <li><strong>Uvicorn</strong> (ASGI server): lightweight, async; production run either with Gunicorn + Uvicorn workers or using Uvicorn and process manager. The list included <code>uvicorn</code>.</li> <li><strong>asyncpg</strong>: async Postgres driver with great performance for coroutine-based stack. Use with SQLAlchemy (1.4+ async ORM) or with a lean SQL layer like <code>databases</code> if preferred. You included <code>enacit4r-sql</code> so integrate with that.</li> <li><strong>psycopg3</strong>: kept for CLI / tooling that prefer sync driver.</li> <li><strong>Alembic</strong>: migrations management standard for SQLAlchemy.</li> <li><strong>Dynaconf + python-dotenv</strong>: structured config that supports env vars, multiple environments; Dynaconf integrates well with Docker/K8s patterns.</li> <li><strong>EPFL enacit4r-* packages</strong>: reuse EPFL-specific helpers (files, auth, sql). Pin exact git revisions for reproducibility.</li> <li> <p><strong>Uv (recommended)</strong> as package manager</p> </li> <li> <p><em>Why not pip alone?</em> Pip doesn't produce a lockfile by default; Uv gives locked, reproducible builds. This is important in production.</p> </li> </ul> <p><strong>Security &amp; standards</strong></p> <ul> <li>Implement JWT/OIDC integration with MS Entra ID using a dedicated module (enacit4r-auth or standard libraries such as <code>python-jose</code>, <code>authlib</code> or <code>fastapi_oidc</code>). Provide an auth module that maps Entra group claims to application roles.</li> <li>Auth integration should be a pluggable adapter so the app can be used by other universities without Entra (e.g., simple OAuth2 provider or local SAML plugin).</li> <li>Logging structured as JSON (logfmt or JSON) to feed EPFL SIEM. Include request IDs, user GUIDs (where allowed), timestamps, severity, and event types.</li> <li>Security scanning: SAST (Bandit/semgrep), dependency scan (safety, Dependabot or GitHub Dependabot), container scanning (Trivy).</li> </ul> <hr> <h3 id=33-data-caching-redis-decision>3.3 Data &amp; caching — Redis decision<a class=headerlink href=#33-data-caching-redis-decision title="Permanent link">&para;</a></h3> <p><strong>Do we need Redis?</strong> — <strong>Recommendation: Yes (recommended)</strong></p> <p><strong>Why Redis is recommended</strong></p> <ul> <li><strong>Cache emission factors</strong> and static lookups (e.g., NACRES mapping, factor sets) to reduce DB queries and speed dashboard loads during peak (February annual load).</li> <li><strong>Rate limiting</strong> (per-user or per-IP) implemented in Redis is standard and helps protect from abusive loads.</li> <li><strong>Short-lived sessions / token revocation lists</strong>: If we use JWTs, sessions are stateless but JWT revocation (logout / forced logout) requires a store. Redis is the natural choice.</li> <li><strong>Background job broker</strong>: Celery/RQ require a broker—Redis is also commonly used here.</li> <li><strong>Feature flags &amp; ephemeral storage</strong>: Redis is handy for locks, counters, and concurrency control.</li> </ul> <p><strong>Costs &amp; trade-offs</strong></p> <ul> <li>Adds operational complexity (another service to manage).</li> <li>If you <em>must</em> minimize infrastructure and you accept eventual longer response times and no revocation capability, you could omit Redis initially and rely completely on database caching + CDN. But given the expected annual spikes, using Redis early reduces DB load and is safer.</li> </ul> <p><strong>Conclusion:</strong> Include Redis as an optional-but-highly-recommended service in all environments (dev: single container, staging/prod: managed Redis instance or k8s operator). Use Redis for caching, rate limits, and the job broker.</p> <hr> <h3 id=34-background-processing>3.4 Background processing<a class=headerlink href=#34-background-processing title="Permanent link">&para;</a></h3> <ul> <li><strong>Option A (recommended):</strong> Celery with Redis broker + Redis result backend. Mature, widely-known.</li> </ul> <p><strong>Recommendation:</strong> Celery for max flexibility (scheduling, retries, priorities). Use it for heavy tasks: ingest CSVs, long-running factor recalculations, export generation (PDF), and optionally for auto-ingestion jobs.</p> <hr> <h3 id=35-session-auth-flow>3.5 Session &amp; auth flow<a class=headerlink href=#35-session-auth-flow title="Permanent link">&para;</a></h3> <ul> <li><strong>Primary:</strong> OIDC login via MS Entra ID (EPFL). Use OIDC provider to receive id_token + access_token. Validate tokens server-side (signature, audience, expiry) using <code>python-jose</code> or <code>authlib</code>. Map Entra claims / groups to app roles (Gestionnaire IT, Gestionnaire Métier, etc.).</li> <li><strong>Statelessness:</strong> Use JWTs for session tokens to stay stateless and scale horizontally. Keep token lifetime short and use refresh tokens if necessary.</li> <li><strong>Revocation / logout:</strong> Implement token revocation via Redis blacklist (recommended). Without Redis, revocation is hard.</li> <li><strong>Pluggable module:</strong> Build auth adapter interface so the auth layer can be swapped for other IDM (SAML2) for non-Entra institutions.</li> </ul> <hr> <h3 id=36-database-data-model-notes>3.6 Database &amp; data model notes<a class=headerlink href=#36-database-data-model-notes title="Permanent link">&para;</a></h3> <ul> <li><strong>Postgres</strong> (primary). Use schemas for separation (e.g., <code>public</code>, <code>audit</code>, <code>analytics</code>) if desired.</li> <li><strong>Connection pooling:</strong> Use <code>asyncpg</code> with built-in pool, configure pool size according to pod/worker counts; use PgBouncer if high concurrency is expected.</li> <li><strong>Migrations:</strong> Alembic. Keep migration scripts in repo; enforce code review on migrations.</li> <li><strong>Backups:</strong> Conform to EPFL backup policy — automated backups, retention (align with cahier: results stored 10 years, some travel data 5 years). Store backups in EPFL-approved storage.</li> <li><strong>Audit logs:</strong> All writes and important changes logged (who, when, what), and logs forwarded to SIEM.</li> </ul> <hr> <h3 id=37-containerization-orchestration>3.7 Containerization &amp; orchestration<a class=headerlink href=#37-containerization-orchestration title="Permanent link">&para;</a></h3> <ul> <li><strong>Images:</strong> OCI-compliant, small base images (python:3.13-slim or distroless) with multi-stage builds. EPFL requirement: support OS patching and updates.</li> <li> <p><strong>docker-compose (dev / Ansible flows):</strong></p> </li> <li> <p>Use Traefik as reverse proxy in compose for routing, TLS (Let’s Encrypt or cert manager for local certs), and for ease of Ansible-driven deployments.</p> </li> <li> <p>Example services: web (backend), frontend (vite build served by CDN or static nginx), postgres, redis, minio (if object storage required), traefik, pgadmin (optional).</p> </li> <li> <p><strong>Kubernetes (prod):</strong></p> </li> <li> <p>Use k8s manifests or Helm charts.</p> </li> <li>Use <strong>nginx-ingress</strong> controller (as requested) for production ingress. TLS managed with cert-manager.</li> <li>Use Horizontal Pod Autoscaler (HPA) and resource requests/limits for autoscaling.</li> <li>Readiness/liveness probes configured.</li> <li>Use ephemeral storage for pods; persistent volumes only for Postgres (or use managed Postgres). For Redis prefer managed service or k8s operator.</li> <li>Use PodDisruptionBudgets and anti-affinity rules across nodes.</li> <li>Use liveness/readiness for worker pods (Celery) too.</li> </ul> <hr> <h3 id=38-networking-proxies-tls>3.8 Networking, proxies &amp; TLS<a class=headerlink href=#38-networking-proxies-tls title="Permanent link">&para;</a></h3> <ul> <li><strong>k8s ingress:</strong> nginx-ingress controller (EPFL standard) with cert-manager.</li> <li><strong>compose/ansible proxy:</strong> Traefik — matches your Ansible/local flow request. Traefik provides automatic dynamic routing and supports Let's Encrypt, etc.</li> <li><strong>HTTP headers:</strong> Set HSTS, CSP, X-Frame-Options, X-XSS-Protection, Referrer-Policy; enforced at ingress/proxy.</li> <li><strong>CORS:</strong> Backend must implement strict CORS rules allowing only EPFL UIs / origins.</li> </ul> <hr> <h3 id=39-observability-logging>3.9 Observability &amp; logging<a class=headerlink href=#39-observability-logging title="Permanent link">&para;</a></h3> <ul> <li><strong>Metrics:</strong> Instrument FastAPI endpoints with Prometheus client; export <code>/metrics</code>. Frontend usage metrics via custom metrics pipeline (if allowed).</li> <li><strong>Tracing:</strong> OpenTelemetry SDK to capture traces; send to collector, then to tracing backend (Jaeger/Tempo).</li> <li><strong>Logs:</strong> Structured JSON logs from backend, forwarded to EPFL SIEM (ELK or SIEM HTTP ingest). Include correlation ID propagation across frontend/backend.</li> <li><strong>Dashboards:</strong> Grafana dashboards for app &amp; infra metrics; set alerts on errors, latency, job queue sizes, DB connection exhaustion.</li> <li><strong>Error reporting:</strong> Sentry (or EPFL-approved alternative) for uncaught exceptions in backend and front-end.</li> </ul> <hr> <h3 id=310-security-compliance-i-dont-know-tod-dicscuss>3.10 Security &amp; compliance /!\ I DON'T KNOW, TOD DICsCUSS<a class=headerlink href=#310-security-compliance-i-dont-know-tod-dicscuss title="Permanent link">&para;</a></h3> <ul> <li><strong>OWASP best practices:</strong> Input validation, output escaping, CSRF protection where needed, secure cookies.</li> <li><strong>Dependency scanning:</strong> GitHub/GitLab Dependabot + ( Snyk/Trivy ?? )</li> <li><strong>Static analysis:</strong> Bandit/semgrep in CI. ???</li> <li><strong>Secrets:</strong> Use Vault or sealed-secrets; never store secrets in repo.</li> <li><strong>Penetration tests / audits:</strong> EPFL may request an external security audit. Provide budget in options.</li> <li><strong>Data retention policy:</strong> Implement app logic to purge/retain according to cahier (10 years, 5 years for travel). Ensure backups mirror retention rules.</li> </ul> <hr> <h2 id=4-developer-ergonomics-repo-structure-recommended>4 — Developer ergonomics &amp; repo structure (recommended)<a class=headerlink href=#4-developer-ergonomics-repo-structure-recommended title="Permanent link">&para;</a></h2> <p>Monorepo</p> <hr> <h2 id=5-ci-cd-pipeline-recommended>5 — CI / CD pipeline (recommended)<a class=headerlink href=#5-ci-cd-pipeline-recommended title="Permanent link">&para;</a></h2> <ul> <li><strong>Stages:</strong> lint (ESLint + style), unit tests (pytest for backend, vitest/jest for frontend), security scans, build (docker images), push to registry, deploy to staging, run integration tests, promote to prod via manual approval.</li> <li><strong>Image signing:</strong> optional but recommended for production compliance.</li> <li><strong>Canary / Blue/Green:</strong> K8s deployments should allow safe rollouts (rolling update, canary via ingress weights).</li> </ul> <hr> <h2 id=6-example-dev-prod-compose-k8s-artifacts-short>6 — Example dev &amp; prod Compose / k8s artifacts (short)<a class=headerlink href=#6-example-dev-prod-compose-k8s-artifacts-short title="Permanent link">&para;</a></h2> <ul> <li><strong>Docker Compose:</strong> <code>docker-compose.yml</code> with services: backend, frontend(for dev), postgres, redis, traefik, minio (if needed). Traefik configured to route <code>api.local</code> -&gt; backend, <code>app.local</code> -&gt; frontend.</li> <li> <p><strong>K8s:</strong></p> </li> <li> <p>Deployment + Service for backend + HPA + ConfigMap for envs + Secret for keys.</p> </li> <li>Deployment for celery workers.</li> <li>StatefulSet/Managed for Postgres (or external managed service).</li> <li>Redis via operator or managed service.</li> <li>Ingress resource using nginx-ingress controller.</li> </ul> <p><em>(I can produce concrete example <code>docker-compose.yml</code> and k8s manifests or Helm chart if you want — tell me which and I’ll generate.)</em></p> <hr> <h2 id=7-performance-scaling-capacity-planning>7 — Performance, scaling &amp; capacity planning<a class=headerlink href=#7-performance-scaling-capacity-planning title="Permanent link">&para;</a></h2> <ul> <li><strong>Stateless design</strong>: backend pods can scale horizontally; no sticky sessions required.</li> <li><strong>Session strategy:</strong> use JWTs (stateless) + Redis for revocation and short-lived state if needed.</li> <li><strong>DB scaling:</strong> read replicas and connection pooling (PgBouncer) for heavy analytic queries. Use caches (Redis) for repeated factor lookups/aggregates.</li> <li><strong>Peak load (February):</strong> pre-warm caches, increase replicas temporarily via HPA or manual scale; ensure Celery workers and DB sizing can support bulk CSV ingestion and report generation.</li> </ul> <hr> <h2 id=8-versioning-dependency-pinning>8 — Versioning &amp; dependency pinning<a class=headerlink href=#8-versioning-dependency-pinning title="Permanent link">&para;</a></h2> <ul> <li> <p><strong>Frontend deps</strong>: use the versions you provided:</p> </li> <li> <p>marked: ^9.0.3</p> </li> <li>pinia: ^3.0.1</li> <li>quasar: ^2.18.1</li> <li>vue: ^3.5.13</li> <li>vue-i18n: ^11.1.7</li> <li> <p>vue-router: ^4.3.2</p> </li> <li> <p><strong>Backend deps</strong>: pin the listed ones and exact git rev references you provided for enacit4r-* packages, alembic ^1.14.0, asyncpg ^0.30.0, psycopg3 ^2.9.10, dynaconf ^3.2.6, python-dotenv ^1.0.1. Use UV lock for reproducible builds.</p> </li> </ul> <hr> <h2 id=9-final-recommendations-next-steps>9 — Final recommendations / next steps<a class=headerlink href=#9-final-recommendations-next-steps title="Permanent link">&para;</a></h2> <ol> <li><strong>Accept runtime Python 3.13</strong> (we used this in the spec). If EPFL infra forbids 3.13, revert to 3.10/3.11.</li> <li><strong>Include Redis</strong> in staging/prod (strongly recommended). Mark as optional in MVP but prepare code paths for it.</li> <li><strong>Auth adapter</strong>: create a dedicated module that handles OIDC/MS Entra and a fallback for other providers (SAML). Keep it pluggable.</li> <li><strong>CI/CD + k8s manifests</strong>: implement a GitOps pipeline or CI pipeline with staging/prod deployments. I can create sample GitHub Actions + Helm charts.</li> <li><strong>Observability</strong>: wire Prometheus + Grafana + OpenTelemetry early (debugging and capacity planning later).</li> <li><strong>Security hygiene</strong>: configure SAST &amp; dependency scanning in CI before code freeze.</li> </ol> <hr> <h2 id=10-appendix-quick-decision-table>10 — Appendix: quick decision table<a class=headerlink href=#10-appendix-quick-decision-table title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Topic</th> <th style="text-align: right;">Decision</th> </tr> </thead> <tbody> <tr> <td>Python runtime</td> <td style="text-align: right;"><strong>3.13</strong> (target) — compatible with specified deps (they declare 3.10+).</td> </tr> <tr> <td>Package manager (backend)</td> <td style="text-align: right;"><strong>UV</strong> (recommended for locks &amp; reproducible builds).</td> </tr> <tr> <td>Web framework</td> <td style="text-align: right;"><strong>FastAPI</strong></td> </tr> <tr> <td>ASGI server</td> <td style="text-align: right;"><strong>Uvicorn</strong> (with Gunicorn in prod if needed)</td> </tr> <tr> <td>DB</td> <td style="text-align: right;"><strong>Postgres</strong></td> </tr> <tr> <td>Cache / Broker</td> <td style="text-align: right;"><strong>Redis</strong> (recommended)</td> </tr> <tr> <td>Background tasks</td> <td style="text-align: right;"><strong>Celery (Redis broker)</strong></td> </tr> <tr> <td>Auth</td> <td style="text-align: right;"><strong>OIDC / MS Entra</strong> + pluggable adapter</td> </tr> <tr> <td>Containers</td> <td style="text-align: right;">OCI images, docker-compose (Traefik) &amp; k8s (nginx-ingress)</td> </tr> <tr> <td>Observability</td> <td style="text-align: right;">Prometheus, Grafana, OpenTelemetry, ELK/SIEM</td> </tr> </tbody> </table> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 29, 2025 17:21:36 CET">October 29, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg> </span> <nav> <a href=mailto:pierre.guilbert@epfl.ch>Guilbert Pierre</a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> 2025 EPFL — GPL-3.0 License. Built with MkDocs </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.annotate", "navigation.instant", "navigation.instant.prefetch"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "1.0.0"}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>